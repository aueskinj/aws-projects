Refactor code to improve modularity
